name: Auto-merge docs PRs

on:
  pull_request_target:
    types: [opened, reopened, synchronize, labeled]

permissions:
  contents: write
  pull-requests: write

jobs:
  auto-merge-docs:
    if: contains(join(github.event.pull_request.labels.*.name, ','), 'docs')
    runs-on: ubuntu-latest
    steps:
      - name: Check changed files are docs-only
        id: check
        uses: actions/github-script@v8
        with:
          script: |
            const pr = context.payload.pull_request;
            const {owner, repo} = context.repo;
            const files = await github.paginate(
              github.rest.pulls.listFiles,
              {owner, repo, pull_number: pr.number, per_page: 100}
            );
            const ok = files.every(f => f.filename === 'README.md' || f.filename.startsWith('docs/'));
            core.setOutput('only_docs', ok);
      - name: Enable auto-merge (squash)
        if: steps.check.outputs.only_docs == 'true'
        run: gh pr merge ${{ github.event.pull_request.number }} --auto --squash
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
